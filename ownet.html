
<script type="text/javascript">
    RED.nodes.registerType('owserver',{
        category: 'config',
        defaults: {
            host: { value: 'localhost', required: true },
            port: { value: '4304', required: true, validate: RED.validators.number() },
        },
        label: function(){
            return this.host + ':' + this.port;
        }
    });
</script>

<script type="text/x-red" data-template-name="owserver">
    <div class="form-row">
        <label for="node-config-input-host"><i class="fa fa-server"></i> Host</label>
        <input type="text" id="node-config-input-host" placeholder="localhost">
    </div>
    <div class="form-row">
        <label for="node-config-input-port"><i class="fa fa-plug"></i> Port</label>
        <input type="text" id="node-config-input-port" placeholder="4304">
    </div>
</script>

<!-- end owserver config node -->

<script type="text/javascript">
    RED.nodes.registerType('ownet-read',{
        defaults: {
            owserver:           { value:'', type: 'owserver' },
            owserverhost:       { value:'' },
            owserverport:       { value:'' },
            path:			    { value:'', required:true },
            subpath:			{ value:'', required:true },
            name: 				{ value:'' }
        },
        category:   'ownet',
        color:      '#169cf5',
        inputs:     1,
        outputs:    1,
        icon:	    'arrow-in.png',
        align:	    'right',
        label: function() { return 'Read 1-wire device ' || this.name; },
        oneditprepare: function() {
            var server = RED.nodes.node(this.owserver);
            try {
                $("#node-input-path").autocomplete("destroy");
                $("#node-input-subpath").autocomplete("destroy");
            }
            catch (err) {}

            $("#node-input-lookup-path").click(function(){
                //var server = RED.nodes.node(this.owserver);
                $("#node-input-lookup-path").addClass('disabled');
                $("#node-input-lookup-path-icon").removeClass('fa fa-ellipsis-h');
                $("#node-input-lookup-path-icon").addClass('fa fa-pencil');
                $.getJSON('ownet/ls/' + server.host + '/' + server.port + '/', function(data) {
                    var temp = [];
                    temp = data.slice();
                    $("#node-input-path").autocomplete({
                        source:temp,
                        minLenght:0,
                        close: function( event , ui ){
                            $("#node-input-path").autocomplete("destroy");
                            $("#node-input-lookup-path-icon").removeClass('fa fa-pencil');
                            $("#node-input-lookup-path-icon").addClass('fa fa-ellipsis-h');
                            $("#node-input-lookup-path").removeClass('disabled');

                        }
                    }).autocomplete("search","/");
                });
            });
            $("#node-input-lookup-subpath").click(function(){
                //var server = RED.nodes.node(this.owserver);
                $("#node-input-lookup-subpath").addClass('disabled');
                $.getJSON('ownet/ls/' + server.host + '/' + server.port + '/' + $("#node-input-path").val(),function(data) {
                    $("#node-input-lookup-subpath").removeClass('disabled');
                    var temp = [];
                    temp = data.slice();
                    $("#node-input-subpath").autocomplete({
                        source:temp,
                        minLenght:0,
                        close: function( event , ui ){
                            $("#node-input-subpath").autocomplete("destroy");
                        }
                    }).autocomplete("search","/");
                });
            });
        },
        oneditsave: function() {
        }
    });
</script>

<script type="text/x-red" data-template-name="ownet-read">
    <div class="form-row">
        <label for="node-input-owserver"><i class="fa fa-server"></i> OWSERVER</label>
        <input type="text" id="node-input-owserver">
    </div>
    <div class="form-row">
        <label for="node-input-owserverhost"><i class="fa fa-server"></i> host</label>
        <input type="text" id="node-input-owserverhost">
    </div>
    <div class="form-row">
        <label for="node-input-owserverport"><i class="fa fa-server"></i> port</label>
        <input type="text" id="node-input-owserverport">
    </div>
    <div class="form-row">
        <label for="node-input-path"><i class="fa fa-cogs"></i> ROM Code</label>
        <input type="text" id="node-input-path" style="width: 56%">
        <a id="node-input-lookup-path" class="btn"><i id="node-input-lookup-path-icon" class="fa fa-ellipsis-h"></i></a>
    </div>
    <div class="form-row">
        <label for="node-input-subpath"><i class="fa fa-sliders"></i> Property</label>
        <input type="text" id="node-input-subpath" style="width: 56%">
        <a id="node-input-lookup-subpath" class="btn"><i id="node-input-lookup-subpath-icon" class="fa fa-ellipsis-h"></i></a>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>

<script type="text/x-red" data-help-name="ownet-read">
   <p>Read value from 1-wire device over owserver(owfs.org).</p>
   <p>Output <b>msg.topic</b> containing owfs path,</p>
   <p> include device id and property,</p>
   <p> <b>ex</b> /28.97CA2E020000/temperature10</p>
   <p><b>msg.payload</b> containing value as string.</p>
</script>

<!-- end ownet device read node -->

<script type="text/javascript">
    RED.nodes.registerType('ownet-write',{
        category: 'ownet',
        color:"#f54616",
        inputs:1,
        outputs:1,
        icon:	"arrow-in.png",
        align:	"right"
    });
</script>

<script type="text/x-red" data-template-name="ownet-write">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>

<!-- end ownet device write node -->
